{"version":3,"sources":["../../../src/cli/docker-commands/command-stop.ts"],"sourcesContent":["import { Command } from 'commander'\nimport { dockerCompose } from './docker-utils'\nimport { getConfig, Config } from '../config'\n\ntype StopCommandArgs = {\n  config: Config\n  remove?: boolean\n}\n\nexport function makeStopCommand() {\n  return new Command('stop')\n    .description(\n      'Stop the ElectricSQL sync service, and any optional PostgreSQL'\n    )\n    .option('-r --remove', 'Also remove the containers and volumes')\n    .action(async (opts: StopCommandArgs) => {\n      stop({\n        config: getConfig(),\n        remove: opts.remove,\n      })\n    })\n}\n\nexport function stop(opts: StopCommandArgs) {\n  const config = opts.config\n  return new Promise<void>((resolve) => {\n    const env = {\n      COMPOSE_PROFILES: 'with-postgres', // Stop any PostgreSQL containers too\n    }\n    let proc\n    if (opts.remove) {\n      proc = dockerCompose('down', ['--volumes'], config.CONTAINER_NAME, env)\n    } else {\n      proc = dockerCompose('stop', [], config.CONTAINER_NAME, env)\n    }\n    proc.on('close', (code) => {\n      if (code !== 0) {\n        console.error('Failed to stop the ElectricSQL sync service.')\n        process.exit(code ?? 1)\n      } else {\n        resolve()\n      }\n    })\n  })\n}\n"],"mappings":"AAAA,SAAS,eAAe;AACxB,SAAS,qBAAqB;AAC9B,SAAS,iBAAyB;AAO3B,SAAS,kBAAkB;AAChC,SAAO,IAAI,QAAQ,MAAM,EACtB;AAAA,IACC;AAAA,EACF,EACC,OAAO,eAAe,wCAAwC,EAC9D,OAAO,OAAO,SAA0B;AACvC,SAAK;AAAA,MACH,QAAQ,UAAU;AAAA,MAClB,QAAQ,KAAK;AAAA,IACf,CAAC;AAAA,EACH,CAAC;AACL;AAEO,SAAS,KAAK,MAAuB;AAC1C,QAAM,SAAS,KAAK;AACpB,SAAO,IAAI,QAAc,CAAC,YAAY;AACpC,UAAM,MAAM;AAAA,MACV,kBAAkB;AAAA;AAAA,IACpB;AACA,QAAI;AACJ,QAAI,KAAK,QAAQ;AACf,aAAO,cAAc,QAAQ,CAAC,WAAW,GAAG,OAAO,gBAAgB,GAAG;AAAA,IACxE,OAAO;AACL,aAAO,cAAc,QAAQ,CAAC,GAAG,OAAO,gBAAgB,GAAG;AAAA,IAC7D;AACA,SAAK,GAAG,SAAS,CAAC,SAAS;AACzB,UAAI,SAAS,GAAG;AACd,gBAAQ,MAAM,8CAA8C;AAC5D,gBAAQ,KAAK,QAAQ,CAAC;AAAA,MACxB,OAAO;AACL,gBAAQ;AAAA,MACV;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AACH;","names":[]}