{"version":3,"sources":["../../src/util/common.ts"],"sourcesContent":["import { numberToBytes } from './encoders/common'\nimport { SatelliteError } from './types'\n\nexport const DEFAULT_LOG_POS = numberToBytes(0)\n\nexport type PromiseWithResolvers<T> = {\n  promise: Promise<T>\n  resolve: (value: T | PromiseLike<T>) => void\n  reject: (reason?: any) => void\n}\n\nexport function emptyPromise<T = void>(): PromiseWithResolvers<T> {\n  let resolve: (value: T | PromiseLike<T>) => void\n  let reject: (reason?: any) => void\n  const promise = new Promise<T>((res, rej) => {\n    resolve = res\n    reject = rej\n  })\n\n  // @ts-ignore TS complains that resolve/reject are used here before assignment, but promise constructor will run synchronously\n  return { promise, resolve, reject }\n}\n\nexport type Waiter = {\n  waitOn: () => Promise<void>\n  resolve: () => Promise<void>\n  reject: (error: SatelliteError) => Promise<void>\n  finished: () => boolean\n}\n\nexport function getWaiter(): Waiter {\n  const { promise, resolve, reject } = emptyPromise()\n  let waiting = false\n  let finished = false\n\n  return {\n    waitOn: async () => {\n      waiting = true\n      await promise\n    },\n\n    resolve: async () => {\n      finished = true\n      resolve()\n    },\n\n    reject: async (error) => {\n      finished = true\n      waiting ? reject(error) : resolve()\n    },\n\n    finished: () => {\n      return finished\n    },\n  }\n}\n\n/**\n * Checks whether the provided value is an object and not an\n * array of some sort\n * @param value - value to check\n * @returns {boolean} whether the `value` is an actual object\n */\nexport function isObject(value: any): value is object {\n  return typeof value === 'object' && value !== null && !Array.isArray(value)\n}\n"],"mappings":"AAAA,SAAS,qBAAqB;AAGvB,MAAM,kBAAkB,cAAc,CAAC;AAQvC,SAAS,eAAkD;AAChE,MAAI;AACJ,MAAI;AACJ,QAAM,UAAU,IAAI,QAAW,CAAC,KAAK,QAAQ;AAC3C,cAAU;AACV,aAAS;AAAA,EACX,CAAC;AAGD,SAAO,EAAE,SAAS,SAAS,OAAO;AACpC;AASO,SAAS,YAAoB;AAClC,QAAM,EAAE,SAAS,SAAS,OAAO,IAAI,aAAa;AAClD,MAAI,UAAU;AACd,MAAI,WAAW;AAEf,SAAO;AAAA,IACL,QAAQ,YAAY;AAClB,gBAAU;AACV,YAAM;AAAA,IACR;AAAA,IAEA,SAAS,YAAY;AACnB,iBAAW;AACX,cAAQ;AAAA,IACV;AAAA,IAEA,QAAQ,OAAO,UAAU;AACvB,iBAAW;AACX,gBAAU,OAAO,KAAK,IAAI,QAAQ;AAAA,IACpC;AAAA,IAEA,UAAU,MAAM;AACd,aAAO;AAAA,IACT;AAAA,EACF;AACF;AAQO,SAAS,SAAS,OAA6B;AACpD,SAAO,OAAO,UAAU,YAAY,UAAU,QAAQ,CAAC,MAAM,QAAQ,KAAK;AAC5E;","names":[]}